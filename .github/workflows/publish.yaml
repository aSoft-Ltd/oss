# This file was generated using Kotlin DSL (.github/workflows/publish.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/typesafegithub/github-workflows-kt

name: "Build, Cache then Publish"
on:
  push:
    branches:
      - "main"
env:
  ORG_GRADLE_PROJECT_mavenCentralUsername: "${{ secrets.ASOFT_NEXUS_USERNAME }}"
  ORG_GRADLE_PROJECT_mavenCentralPassword: "${{ secrets.ASOFT_NEXUS_PASSWORD }}"
  ORG_GRADLE_PROJECT_signingInMemoryKey: "${{ secrets.ORG_GRADLE_PROJECT_SIGNINGINMEMORYKEY }}"
  ORG_GRADLE_PROJECT_signingInMemoryKeyPassword: "${{ secrets.ORG_GRADLE_PROJECT_SIGNINGINMEMORYKEYPASSWORD }}"
  TARGETING_ALL: "true"
jobs:
  rendezvous:
    runs-on: "ubuntu-latest"
    steps:
      - id: "step-0"
        run: 'echo "all builds completed. Beginning deployment"'
  kiota-publisher:
    runs-on: "macos-latest"
    needs:
      - "rendezvous"
    steps:
      - id: "step-0"
        uses: "actions/checkout@v3"
        with:
          submodules: "true"
      - id: "step-1"
        uses: "actions/setup-java@v3"
        with:
          java-version: "18"
          distribution: "corretto"
      - id: "step-2"
        name: "Make ./gradlew executable"
        working-directory: "kiota"
        run: "chmod +x ./gradlew"
      - id: "step-3"
        name: "publishing kiota-url, kiota-sse, kiota-file-core, kiota-file-system, kiota-file-virtual, kiota-file-compose, kiota-file-picker-core, kiota-file-picker-system, kiota-file-picker-virtual, kiota-file-manager-core, kiota-file-manager-system, kiota-file-manager-virtual"
        uses: "gradle/gradle-build-action@v2"
        with:
          build-root-directory: "./kiota"
          cache-disabled: "true"
          arguments: "kotlinUpgradePackageLock :kiota-url:publishAllPublicationsToMavenCentral :kiota-sse:publishAllPublicationsToMavenCentral :kiota-file-core:publishAllPublicationsToMavenCentral :kiota-file-system:publishAllPublicationsToMavenCentral :kiota-file-virtual:publishAllPublicationsToMavenCentral :kiota-file-compose:publishAllPublicationsToMavenCentral :kiota-file-picker-core:publishAllPublicationsToMavenCentral :kiota-file-picker-system:publishAllPublicationsToMavenCentral :kiota-file-picker-virtual:publishAllPublicationsToMavenCentral :kiota-file-manager-core:publishAllPublicationsToMavenCentral :kiota-file-manager-system:publishAllPublicationsToMavenCentral :kiota-file-manager-virtual:publishAllPublicationsToMavenCentral --no-configuration-cache"
